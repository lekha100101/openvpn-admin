{% extends "base.html" %}
{% block title %}Администраторы{% endblock %}
{% block content %}
<h2 class="mb-4">Создать администратора</h2>
<form method="POST" class="card shadow p-4 mb-5">
  <div class="mb-3"><input name="username" class="form-control" placeholder="Логин" required></div>
  <div class="mb-3"><input name="password" type="password" class="form-control" placeholder="Пароль" required></div>
  <div class="mb-3">
    <select name="role" class="form-select">
      <option value="admin">admin</option>
      <option value="viewer">viewer</option>
      <option value="superadmin">superadmin</option>
    </select>
  </div>
  <button class="btn btn-success w-100" type="submit">Создать</button>
</form>

<h2 class="mb-3">Список администраторов</h2>
<table class="table table-striped">
  <thead><tr><th>Логин</th><th>Роль</th><th>Активен</th><th>Действия</th></tr></thead>
  <tbody>
  {% for a in admins %}
    <tr>
      <td>{{ a.username }}</td>
      <td>
        <form method="post" action="{{ url_for('admin_change_role', admin_id=a.id) }}">
          <select name="role" class="form-select form-select-sm" onchange="this.form.submit()">
            {% for r in ['viewer','admin','superadmin'] %}
              <option value="{{ r }}" {{ 'selected' if a.role==r else '' }}>{{ r }}</option>
            {% endfor %}
          </select>
        </form>
      </td>
      <td>{{ 'Да' if a.is_active else 'Нет' }}</td>
      <td class="d-flex gap-2">
        <form method="post" action="{{ url_for('admin_toggle', admin_id=a.id) }}">
          <button class="btn btn-sm {{ 'btn-warning' if a.is_active else 'btn-success' }}" {{ 'disabled' if a.id==current_user.id else '' }}>
            {{ 'Отключить' if a.is_active else 'Включить' }}
          </button>
        </form>
        <form method="post" action="{{ url_for('admin_reset_password', admin_id=a.id) }}" onsubmit="return confirm('Сбросить пароль?')">
          <button class="btn btn-sm btn-secondary">Сброс пароля</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}

